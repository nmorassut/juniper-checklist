<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pre-Construction Checklist - Juniper Engineers</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Montserrat', sans-serif; background-color: #fafafa; color: #4A515A; line-height: 1.6; }
    .container { max-width: 800px; margin: 0 auto; padding: 2rem; }
    .header { background: white; border-bottom: 1px solid #e5e5e5; padding: 1.5rem 2rem; margin-bottom: 2rem; }
    .header-content { max-width: 800px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; }
    .logo { height: 25px; width: auto; }
    .project-banner { background: white; border: 1px solid #e5e5e5; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem; }
    .project-banner h1 { font-size: 1.5rem; font-weight: 600; color: #4A515A; margin-bottom: 0.5rem; }
    .project-meta { display: flex; gap: 2rem; color: #6C7883; font-size: 0.875rem; }
    .form-section { background: white; border: 1px solid #e5e5e5; border-radius: 8px; margin-bottom: 1.5rem; overflow: hidden; }
    .section-header { background: #fafafa; padding: 1rem 1.5rem; border-bottom: 1px solid #e5e5e5; }
    .section-header h2 { font-size: 0.875rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: #4A515A; }
    .section-body { padding: 1.5rem; }
    .form-group { margin-bottom: 1.25rem; }
    .form-group:last-child { margin-bottom: 0; }
    .form-group label { display: block; font-size: 0.875rem; font-weight: 500; color: #4A515A; margin-bottom: 0.5rem; }
    .form-group input[type="text"],
    .form-group input[type="email"],
    .form-group input[type="date"],
    .form-group textarea { 
      width: 100%; padding: 0.75rem 1rem; border: 1px solid #e5e5e5; border-radius: 4px; 
      font-family: 'Montserrat', sans-serif; font-size: 0.875rem; color: #4A515A; 
    }
    .form-group textarea { min-height: 80px; resize: vertical; }
    .form-group input:focus, .form-group textarea:focus { outline: none; border-color: #4A515A; }
    .checkbox-item { display: flex; align-items: flex-start; gap: 0.75rem; padding: 0.75rem; border: 1px solid #e5e5e5; border-radius: 4px; margin-bottom: 0.5rem; cursor: pointer; transition: all 0.2s; }
    .checkbox-item:hover { border-color: #6C7883; }
    .checkbox-item.checked { background: #f0fdf4; border-color: #059669; }
    .checkbox-item input[type="checkbox"] { width: 20px; height: 20px; margin-top: 2px; cursor: pointer; flex-shrink: 0; }
    .checkbox-item .checkbox-label { flex: 1; font-size: 0.875rem; color: #4A515A; }
    .checkbox-simple { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; cursor: pointer; }
    .checkbox-simple input { width: 18px; height: 18px; cursor: pointer; }
    .checkbox-simple span { font-size: 0.875rem; color: #4A515A; }
    .warning-box { background: #FEF3C7; border-left: 4px solid #F59E0B; padding: 1rem; margin-bottom: 1rem; }
    .warning-box p { font-size: 0.8125rem; color: #92400E; margin: 0; }
    .info-box { background: #EFF6FF; border-left: 4px solid #3B82F6; padding: 1rem; margin-bottom: 1rem; }
    .info-box p { font-size: 0.8125rem; color: #1E40AF; margin: 0; }
    .two-column { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    .signature-section { background: #fafafa; padding: 1.5rem; border-top: 1px solid #e5e5e5; }
    .signature-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 1rem; margin-top: 1rem; }
    .btn { display: inline-flex; align-items: center; justify-content: center; padding: 0.875rem 1.5rem; border-radius: 4px; font-family: 'Montserrat', sans-serif; font-size: 0.875rem; font-weight: 500; cursor: pointer; border: none; text-transform: uppercase; letter-spacing: 0.05em; }
    .btn-primary { background: #4A515A; color: white; width: 100%; }
    .btn-primary:hover { background: #3a4048; }
    .btn-primary:disabled { background: #A6A39E; cursor: not-allowed; }
    .loading { text-align: center; padding: 4rem 2rem; color: #6C7883; }
    .error { text-align: center; padding: 4rem 2rem; color: #DC2626; }
    .success-message { background: #D1FAE5; border: 1px solid #059669; border-radius: 8px; padding: 2rem; text-align: center; margin: 2rem 0; }
    .success-message h2 { color: #059669; margin-bottom: 0.5rem; }
    .success-message p { color: #065F46; }
    .hidden { display: none !important; }
    .required::after { content: ' *'; color: #DC2626; }
    .form-footer { text-align: center; padding: 2rem; color: #A6A39E; font-size: 0.75rem; }
    @media (max-width: 640px) {
      .container { padding: 1rem; }
      .two-column, .signature-grid { grid-template-columns: 1fr; }
      .project-meta { flex-direction: column; gap: 0.5rem; }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <img src="https://raw.githubusercontent.com/nmorassut/juniper-checklist/main/j-logo-text-black-rgb.png" alt="Juniper Engineers" class="logo">
      <span style="font-size: 0.75rem; color: #6C7883; text-transform: uppercase; letter-spacing: 0.05em;">Pre-Construction Checklist</span>
    </div>
  </header>

  <div class="container" id="loadingState">
    <div class="loading">Loading checklist...</div>
  </div>

  <div class="container hidden" id="errorState">
    <div class="error">
      <h2>Checklist Not Found</h2>
      <p>This checklist link may be invalid or expired. Please contact Juniper Engineers.</p>
    </div>
  </div>

  <div class="container hidden" id="successState">
    <div class="success-message">
      <h2>‚úì Checklist Submitted Successfully</h2>
      <p>Thank you for completing the pre-construction checklist. Juniper Engineers has been notified and will be in touch.</p>
    </div>
  </div>

  <div class="container hidden" id="formContainer">
    <div class="project-banner">
      <h1 id="projectName">Project Name</h1>
      <div class="project-meta">
        <span>üìç <span id="projectLocation">Location</span></span>
        <span>üìÖ Sent: <span id="projectSentDate">Date</span></span>
      </div>
    </div>

    <form id="checklistForm">
      
      <!-- Section 1: Contractor Information -->
      <div class="form-section">
        <div class="section-header">
          <h2>Section 1: Contractor Information</h2>
        </div>
        <div class="section-body">
          <div class="two-column">
            <div class="form-group">
              <label class="required">Your Name</label>
              <input type="text" id="contractorName" required>
            </div>
            <div class="form-group">
              <label class="required">Your Role/Title</label>
              <input type="text" id="contractorRole" required>
            </div>
          </div>
          <div class="form-group">
            <label class="required">Email</label>
            <input type="email" id="contractorEmailInput" required>
          </div>
          <div class="form-group">
            <label>Site Supervisor (if different)</label>
            <input type="text" id="siteSupervisor" placeholder="Name">
          </div>
        </div>
      </div>

      <!-- Section 2: Drawing Package -->
      <div class="form-section">
        <div class="section-header">
          <h2>Section 2: Drawing Package</h2>
        </div>
        <div class="section-body">
          <div class="warning-box">
            <p><strong>Building Permit (BP) drawings are NOT for construction.</strong> All BP hard copies must be destroyed or removed from site. Only Issued For Construction (IFC) drawings shall be used. If IFC drawings are not yet issued, BP may be used for rough pricing only.</p>
          </div>
          
          <div class="checkbox-item" onclick="toggleCheckbox(this)">
            <input type="checkbox" id="ackDrawings" required>
            <div class="checkbox-label">I understand BP drawings are not for construction and will ensure all trades use IFC drawings only</div>
          </div>
        </div>
      </div>

      <!-- Section 3: General Notes -->
      <div class="form-section">
        <div class="section-header">
          <h2>Section 3: General Notes Review</h2>
        </div>
        <div class="section-body">
          <div class="info-box">
            <p>Review the Structural General Notes included with the drawing package. These contain critical information about materials, connections, and construction requirements.</p>
          </div>
          
          <div class="checkbox-item" onclick="toggleCheckbox(this)">
            <input type="checkbox" id="ackGeneralNotes" required>
            <div class="checkbox-label">I have read and understand the Structural General Notes</div>
          </div>
          
          <div class="form-group" style="margin-top: 1rem;">
            <label>Questions about the General Notes?</label>
            <textarea id="generalNotesQuestions" placeholder="Enter any questions or items needing clarification..."></textarea>
          </div>
        </div>
      </div>

      <!-- Section 4: Shear Wall / Lateral Requirements -->
      <div class="form-section">
        <div class="section-header">
          <h2>Section 4: Shear Wall & Lateral Requirements</h2>
        </div>
        <div class="section-body">
          <div class="warning-box">
            <p><strong>Hold Down Anchors:</strong> HDU hold downs greater than HDU8 and other specified anchors MUST be cast into concrete. Post-installed or epoxy anchors are NOT permitted. Refer to plans or contact Juniper.</p>
          </div>
          
          <div class="checkbox-item" onclick="toggleCheckbox(this)">
            <input type="checkbox" id="ackHoldDowns" required>
            <div class="checkbox-label">I understand cast-in-place anchor requirements</div>
          </div>
          
          <div class="warning-box">
            <p><strong>Shear Wall Nailing:</strong> Nail gun pressure must be set evenly. Overdriven nails exceeding 10% of panel thickness will be rejected.</p>
          </div>
          
          <div class="checkbox-item" onclick="toggleCheckbox(this)">
            <input type="checkbox" id="ackNailing" required>
            <div class="checkbox-label">I understand shear wall nailing requirements</div>
          </div>
        </div>
      </div>

      <!-- Section 5: Shop Drawings -->
      <div class="form-section">
        <div class="section-header">
          <h2>Section 5: Shop Drawings</h2>
        </div>
        <div class="section-body">
          <div class="checkbox-item" onclick="toggleCheckbox(this)">
            <input type="checkbox" id="ackShopDrawings" required>
            <div class="checkbox-label">I understand shop drawings must be submitted and approved before fabrication</div>
          </div>
          
          <div class="form-group" style="margin-top: 1rem;">
            <label>Fabricators engaged (check all that apply):</label>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem;">
            <label class="checkbox-simple"><input type="checkbox" id="fabSteel"> <span>Steel</span></label>
            <label class="checkbox-simple"><input type="checkbox" id="fabEWP"> <span>EWP Supplier</span></label>
            <label class="checkbox-simple"><input type="checkbox" id="fabIJoist"> <span>I-Joist</span></label>
            <label class="checkbox-simple"><input type="checkbox" id="fabTruss"> <span>Truss</span></label>
            <label class="checkbox-simple"><input type="checkbox" id="fabWallPanel"> <span>Wall Panel</span></label>
            <label class="checkbox-simple"><input type="checkbox" id="fabMassTimber"> <span>Mass Timber</span></label>
          </div>
          
          <div class="form-group">
            <label>Fabricators not yet engaged</label>
            <textarea id="fabricatorsNotEngaged" placeholder="List any fabricators still needed..."></textarea>
          </div>
          
          <div class="warning-box">
            <p><strong>EWP Grades:</strong> Confirm your supplier stocks the material grades and joist series listed in Juniper's general notes. Notify Juniper of any discrepancies BEFORE shop drawing submittal.</p>
          </div>
          
          <div class="checkbox-item" onclick="toggleCheckbox(this)">
            <input type="checkbox" id="ackEWPGrades">
            <div class="checkbox-label">I have confirmed EWP grades with supplier (or will notify Juniper of discrepancies)</div>
          </div>
          
          <div class="form-group" style="margin-top: 1rem;">
            <label>EWP supplier and any concerns</label>
            <textarea id="ewpSupplierNotes" placeholder="Supplier name and any grade/series concerns..."></textarea>
          </div>
        </div>
      </div>

      <!-- Section 6: Field Reviews -->
      <div class="form-section">
        <div class="section-header">
          <h2>Section 6: Field Reviews</h2>
        </div>
        <div class="section-body">
          <div class="warning-box">
            <p><strong>48 hour advance notice is required</strong> for all field reviews. Structural elements must not be covered until reviewed by Juniper.</p>
          </div>
          
          <div class="checkbox-item" onclick="toggleCheckbox(this)">
            <input type="checkbox" id="ackFieldReviewNotice" required>
            <div class="checkbox-label">I will provide 48 hour notice and not cover structural elements until reviewed</div>
          </div>
          
          <div class="info-box">
            <p><strong>Concrete Reviews:</strong> One side of forms must remain off so reinforcing is clearly visible. Adequate time must be provided for review before pour.</p>
          </div>
          
          <div class="checkbox-item" onclick="toggleCheckbox(this)">
            <input type="checkbox" id="ackConcreteReview" required>
            <div class="checkbox-label">I understand concrete reinforcing review requirements</div>
          </div>
          
          <div class="form-group" style="margin-top: 1rem;">
            <label class="checkbox-simple">
              <input type="checkbox" id="icfWalls"> 
              <span>ICF walls will be used on this project</span>
            </label>
          </div>
          
          <div class="info-box">
            <p><strong>If ICF:</strong> Photos of horizontal rebar in the first course must be reviewed by Juniper before proceeding with subsequent courses.</p>
          </div>
          
          <div class="warning-box">
            <p><strong>Photo Reviews:</strong> Photo reviews are at Juniper's sole discretion and may not be accepted without prior approval.</p>
          </div>
          
          <div class="checkbox-item" onclick="toggleCheckbox(this)">
            <input type="checkbox" id="ackPhotoReviews" required>
            <div class="checkbox-label">I understand photo reviews require prior Juniper approval</div>
          </div>
          
          <div class="info-box">
            <p><strong>Scope:</strong> Field Review confirms general conformance with structural drawings. It is NOT inspection or supervision. The contractor remains responsible for ensuring work meets the drawings.</p>
          </div>
          
          <div class="checkbox-item" onclick="toggleCheckbox(this)">
            <input type="checkbox" id="ackFieldReviewScope" required>
            <div class="checkbox-label">I understand I am responsible for ensuring work meets the structural drawings</div>
          </div>
        </div>
      </div>

      <!-- Section 7: Construction Timeline -->
      <div class="form-section">
        <div class="section-header">
          <h2>Section 7: Construction Timeline</h2>
        </div>
        <div class="section-body">
          <div class="two-column">
            <div class="form-group">
              <label class="required">Anticipated Start Date</label>
              <input type="date" id="startDate" required>
            </div>
            <div class="form-group">
              <label class="required">Estimated Duration</label>
              <input type="text" id="projectDuration" placeholder="e.g., 8 months" required>
            </div>
          </div>
        </div>
      </div>

      <!-- Section 8: Additional Notes -->
      <div class="form-section">
        <div class="section-header">
          <h2>Section 8: Additional Notes</h2>
        </div>
        <div class="section-body">
          <div class="form-group">
            <label>Questions, concerns, or items to discuss?</label>
            <textarea id="additionalNotes" placeholder="Anything else before construction begins..."></textarea>
          </div>
        </div>
      </div>

      <!-- Signature -->
      <div class="form-section">
        <div class="section-header">
          <h2>Acknowledgment & Signature</h2>
        </div>
        <div class="section-body">
          <div class="checkbox-item" onclick="toggleCheckbox(this)">
            <input type="checkbox" id="finalAck" required>
            <div class="checkbox-label">I confirm this information is accurate and I have reviewed the structural drawings and general notes</div>
          </div>
          
          <div class="signature-grid" style="margin-top: 1rem;">
            <div class="form-group">
              <label class="required">Signature (Type Full Name)</label>
              <input type="text" id="signature" required placeholder="Full name">
            </div>
            <div class="form-group">
              <label class="required">Date</label>
              <input type="date" id="signatureDate" required>
            </div>
          </div>
        </div>
        
        <div class="signature-section">
          <button type="submit" class="btn btn-primary" id="submitBtn">Submit Checklist</button>
        </div>
      </div>
    </form>

    <div class="form-footer">
      <p>Juniper Engineers | juniperengineers.com</p>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBthH9qo1nIWFkQV8WnW_9IX8j0c4GMf7s",
      authDomain: "juniper-pre-construction.firebaseapp.com",
      projectId: "juniper-pre-construction",
      storageBucket: "juniper-pre-construction.firebasestorage.app",
      messagingSenderId: "708367923638",
      appId: "1:708367923638:web:fb5517db71551eedb0a917"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    let checklistId = null;
    let checklistData = null;

    function getChecklistId() {
      const params = new URLSearchParams(window.location.search);
      return params.get('id');
    }

    async function loadChecklist() {
      checklistId = getChecklistId();
      if (!checklistId) { showError(); return; }

      try {
        const doc = await db.collection('checklists').doc(checklistId).get();
        if (!doc.exists) { showError(); return; }

        checklistData = doc.data();
        if (checklistData.status === 'complete') { showSuccess(); return; }

        document.getElementById('projectName').textContent = checklistData.projectName;
        document.getElementById('projectLocation').textContent = checklistData.location || 'Not specified';
        document.getElementById('projectSentDate').textContent = checklistData.sentDate || '';
        
        if (checklistData.contractorEmail) {
          document.getElementById('contractorEmailInput').value = checklistData.contractorEmail;
        }
        document.getElementById('signatureDate').value = new Date().toISOString().split('T')[0];

        await db.collection('checklists').doc(checklistId).update({
          status: 'in-progress',
          lastViewed: new Date().toISOString()
        });

        showForm();
      } catch (error) {
        console.error('Error:', error);
        showError();
      }
    }

    function showForm() {
      document.getElementById('loadingState').classList.add('hidden');
      document.getElementById('errorState').classList.add('hidden');
      document.getElementById('successState').classList.add('hidden');
      document.getElementById('formContainer').classList.remove('hidden');
    }

    function showError() {
      document.getElementById('loadingState').classList.add('hidden');
      document.getElementById('formContainer').classList.add('hidden');
      document.getElementById('successState').classList.add('hidden');
      document.getElementById('errorState').classList.remove('hidden');
    }

    function showSuccess() {
      document.getElementById('loadingState').classList.add('hidden');
      document.getElementById('formContainer').classList.add('hidden');
      document.getElementById('errorState').classList.add('hidden');
      document.getElementById('successState').classList.remove('hidden');
    }

    function toggleCheckbox(element) {
      const checkbox = element.querySelector('input[type="checkbox"]');
      checkbox.checked = !checkbox.checked;
      element.classList.toggle('checked', checkbox.checked);
    }

    document.getElementById('checklistForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';

      try {
        const formData = {
          contractorName: document.getElementById('contractorName').value,
          contractorRole: document.getElementById('contractorRole').value,
          contractorEmail: document.getElementById('contractorEmailInput').value,
          siteSupervisor: document.getElementById('siteSupervisor').value,
          ackDrawings: document.getElementById('ackDrawings').checked,
          ackGeneralNotes: document.getElementById('ackGeneralNotes').checked,
          generalNotesQuestions: document.getElementById('generalNotesQuestions').value,
          ackHoldDowns: document.getElementById('ackHoldDowns').checked,
          ackNailing: document.getElementById('ackNailing').checked,
          ackShopDrawings: document.getElementById('ackShopDrawings').checked,
          fabricatorsEngaged: {
            steel: document.getElementById('fabSteel').checked,
            ewp: document.getElementById('fabEWP').checked,
            iJoist: document.getElementById('fabIJoist').checked,
            truss: document.getElementById('fabTruss').checked,
            wallPanel: document.getElementById('fabWallPanel').checked,
            massTimber: document.getElementById('fabMassTimber').checked
          },
          fabricatorsNotEngaged: document.getElementById('fabricatorsNotEngaged').value,
          ackEWPGrades: document.getElementById('ackEWPGrades').checked,
          ewpSupplierNotes: document.getElementById('ewpSupplierNotes').value,
          ackFieldReviewNotice: document.getElementById('ackFieldReviewNotice').checked,
          ackConcreteReview: document.getElementById('ackConcreteReview').checked,
          icfWalls: document.getElementById('icfWalls').checked,
          ackPhotoReviews: document.getElementById('ackPhotoReviews').checked,
          ackFieldReviewScope: document.getElementById('ackFieldReviewScope').checked,
          startDate: document.getElementById('startDate').value,
          projectDuration: document.getElementById('projectDuration').value,
          additionalNotes: document.getElementById('additionalNotes').value,
          signature: document.getElementById('signature').value,
          signatureDate: document.getElementById('signatureDate').value,
          submittedAt: new Date().toISOString()
        };

        await db.collection('checklists').doc(checklistId).update({
          status: 'complete',
          completedDate: new Date().toISOString().split('T')[0],
          contractorResponse: formData
        });

        showSuccess();
      } catch (error) {
        console.error('Error:', error);
        alert('Error submitting. Please try again.');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Checklist';
      }
    });

    document.addEventListener('DOMContentLoaded', loadChecklist);
  </script>
</body>
</html>
